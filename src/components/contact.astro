---
import CompatibilityList from "~/components/compatibility-list.astro";
import ContentSection from "~/components/content-section.astro";
import type { CompatibilityItem } from "~/types";
import { isEmailValid } from "../utils/index";
import { sendContactUsForm } from "../api/api";
const errors = { name: "", email: "" };
const INPUT_CLASS = "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
const LABEL_CLASS = "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"


if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    const name = data.get("name");
    const email = data.get("email");

    if (typeof name !== "string" || name.length < 1) {
      errors.name += "Please enter your name. ";
    }
    if (typeof email !== "string" || !isEmailValid(email)) {
      errors.email += "Email is not valid. ";
    }

    const hasErrors = Object.values(errors).some(msg => msg)
    if (!hasErrors) {
      await sendContactUsForm(name as string, email as string);
      return Astro.redirect("/login");
    }
  } catch (error) {
    if (error instanceof Error) {
      console.error(error.message);
    }
  }
}

---

<ContentSection title="Contact us" id="contact">
  <Fragment slot="lead">
    Want to see <span class="text-primary">a trick</span>.
  </Fragment>
 
<h1>Let's do magic</h1>

<form method="POST" class="flex flex-col gap-8">
  <div class="flex flex-col">
  <label  class={LABEL_CLASS}>
    Name
  </label>
    <input class={INPUT_CLASS} type="text" name="name" required placeholder="Albus Dumbledore"/>
</div>
<div class="flex flex-col">
  <label  class={LABEL_CLASS}>
    Email
  </label>
    <input class={INPUT_CLASS} type="text" name="email" required placeholder="dumbly@gmail.com"/>
</div>
<div class="flex flex-col">
  <label  class={LABEL_CLASS}>
    Website
  </label>
    <input class={INPUT_CLASS} type="text" name="website" required />
</div>
  <button>Let's do magic</button>
</form>
</ContentSection>
